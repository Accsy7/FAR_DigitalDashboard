# 农村集体经济组织三资公示数字大屏 — 使用手册

  一、项目简介

本项目是一个农村集体经济组织三资（资金、资产、资源）数据公示的数字可视化大屏系统。采用离线地图瓦片 + Web 前端技术，可在脱网环境下通过 Edge 浏览器本地运行，适用于大屏展示场景。

  核心功能

- **离线真实地图背景**：基于 Leaflet.js 加载本地瓦片文件，展示巴马县区域地图（去除真实地名，使用虚拟化名称"甲县"、"A村~G村"）
- **公告展示**：展示农村集体经济组织政策、采购公示等，点击可查看详细内容
- **资金去向**：滚动列表实时展示资金流水明细
- **数据可视化**：ECharts 饼图（年度支出结构分析）和柱状图（年度收支对比）
- **统计概览**：顶部卡片展示集体资产总额、年度收入/支出

---

二、运行环境要求

| 项目 | 要求 |
|------|------|
| 操作系统 | Windows 10 / 11 |
| Python | 3.6 及以上版本 |
| 浏览器 | Microsoft Edge（推荐）/ Chrome |
| 屏幕分辨率 | 1920 × 1080（推荐） |
| 网络 | **运行时无需联网**（首次部署需联网下载资源） |

---

  三、首次部署（需联网）

首次使用需要联网下载前端库文件和地图瓦片数据。

  步骤 1：下载前端依赖库

```bash
python download_libs.py
```

此脚本会自动下载以下文件到 `lib/` 目录：
- Leaflet.js（地图引擎）
- ECharts（图表库）
- Leaflet 图标资源

  步骤 2：下载地图瓦片

```bash
python download_tiles.py
```

此脚本会下载巴马县区域的 Voyager 风格地图瓦片（zoom 10~13），约 2000+ 张 PNG 图片，存储在 `assets/tiles/` 目录。下载耗时约 3~5 分钟。

  步骤 3：下载 GeoJSON 边界数据（可选）

```bash
python download_geojson.py
```

此脚本下载广西省、河池市的行政边界数据，并自动提取巴马县边界。数据存储在 `data/` 目录。

> **注意**：如果 `data/bama.json` 已存在，可跳过此步骤。

---

四、一键运行

  方式一：双击 run.bat

直接双击项目根目录下的 `run.bat` 文件即可自动启动服务并打开浏览器。

方式二：命令行运行

```bash
python start.py
```

启动后会显示：
```
Server running at http://localhost:[端口号]
Press Ctrl+C to stop.
```

端口号自动寻找空闲端口（8000-8100范围），请在命令行查看具体端口号，然后在 Edge 浏览器中访问 `http://localhost:[端口号]`。

  停止服务

在命令行窗口按 `Ctrl+C` 即可停止服务器。

---

五、项目结构

```
农村三资数据大屏/
├── index.html              # 主页面
├── start.py                # 本地服务器启动脚本
├── run.bat                 # 一键运行脚本（Windows）
├── download_libs.py        # 前端库下载脚本
├── download_tiles.py       # 地图瓦片下载脚本
├── download_geojson.py     # GeoJSON 数据下载脚本
├── 使用手册.md             # 本文件
├── 环境依赖.txt            # 环境依赖说明
├── css/
│   └── style.css           # 样式文件
├── js/
│   ├── main.js             # 主逻辑脚本
│   └── data.js             # 模拟数据
├── lib/                    # 前端库文件（离线）
│   ├── leaflet.js
│   ├── leaflet.css
│   ├── echarts.min.js
│   └── images/             # Leaflet 图标
├── assets/
│   └── tiles/              # 离线地图瓦片
│       ├── 10/             # zoom 级别 10
│       ├── 11/             # zoom 级别 11
│       ├── 12/             # zoom 级别 12
│       └── 13/             # zoom 级别 13
└── data/
    ├── bama.json           # 巴马县边界 GeoJSON
    ├── hechi.json          # 河池市边界 GeoJSON
    └── guangxi.json        # 广西省边界 GeoJSON
```

---

六、功能使用说明

  6.1 地图区域

- 地图以巴马县为中心，展示县域边界（青色发光线条）
- 地图上标注了 **甲县**（县城）和 **A~G 共 7 个村庄
- 点击村庄黄色标记可弹出该村的资产信息弹窗
- 地图视角已固定，不可拖拽和缩放

  6.2 左侧面板

- **公告展示**：展示政策法规和采购公示，点击标题弹出详细内容模态框
- **资金去向**：自动滚动展示资金流水记录，绿色为收入，红色为支出

  6.3 右侧面板

- **年度支出结构分析**：环形饼图展示基础设施、公益事业、管理费用、生产投入、社会保障等支出类别的占比
- **年度收支对比**：柱状图展示近年度收入和支出的对比趋势

  6.4 顶部区域

- 标题栏：展示大屏名称
- 统计卡片：集体资产总额、本年度总收入、本年度总支出
- 右上角：实时时钟

---

七、自适应说明

- 本大屏设计分辨率为 **1920 × 1080**
- 内置等比缩放机制，在任意分辨率/浏览器缩放比例下均可**自动全屏填充**
- 建议在 Edge 浏览器中按 **F11** 进入全屏模式以获得最佳展示效果

---

  八、数据修改指南

如需修改展示数据，编辑 `js/data.js` 文件：

- `announcements`：公告列表数据
- `fundFlows`：资金流水数据
- `assetData`：年度支出结构饼图数据（可修改为其他类型的数据结构）
- `incomeData`：年度收支柱状图数据

如需修改村庄位置或名称，编辑 `js/main.js` 中的 `villageMarkers` 数组。

**注意**：修改代码后需要按 Ctrl+Shift+R 强制刷新浏览器页面以清除缓存。

---

九、常见问题

| 问题 | 解决方案 |
|------|----------|
| 地图显示空白 | 检查 `assets/tiles/` 目录是否有瓦片文件，如无则重新运行 `python download_tiles.py` |
| 页面打不开 | 确认 `python start.py` 已运行，端口自动寻找（8000-8100），查看命令行输出的具体端口号 |
| 图表不显示 | 检查 `lib/echarts.min.js` 是否存在，如无则运行 `python download_libs.py` |
| 页面布局异常 | 1. 检查HTML语法是否正确（按F12查看控制台错误）<br>2. 建议使用 Edge 浏览器，按 F11 全屏，缩放设为 100%<br>3. 按 Ctrl+Shift+R 强制刷新页面 |
| 地图显示不全 | 1. 按 Ctrl+Shift+R 强制刷新浏览器缓存<br>2. 检查浏览器控制台（F12）是否有HTML语法错误<br>3. 检查 `index.html` 中`<meta>`标签是否完整 |
| 修改后无效果 | 1. 按 Ctrl+Shift+R 强制刷新浏览器缓存<br>2. 确认文件已保存（Ctrl+S）<br>3. 重启 Python 服务器 |
